<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Web Analytics - Overview</title>

	<!-- stylesheets -->
	<link href="assets/fonts/font-roboto.css" rel="stylesheet">
	<link href="assets/bootstrap/bootstrap4-alpha3.min.css" rel="stylesheet">
	<link href="assets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="assets/web-analytics/style.css" rel="stylesheet">

	<!-- scripts -->
	<script src="assets/jquery/jquery-3.1.0.min.js"></script>
	<script src="assets/tether/tether.min.js"></script>
	<script src="assets/bootstrap/bootstrap4-alpha3.min.js"></script>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
	

<script>


function add(a, b , callback){ 
   var dataSet= []
   var months = {"01":"January", "02":"February", "03":"March", "04":"April","05":"May","06":"June", "07":"July","08":"August","09":"September","10":"October","11":"November","12":"December"}

   $.getJSON('app_download_data.json', function(data) {
       $.each(data.data, function(i, f) {
		var dict = {}
		dict['label'] = months[f.created_at.substr(5,2)]
		dict['y'] = Number(f.new_downloads);
		dataSet.push(dict)
     });
	 console.log("dataSet: ", dataSet)
	 var dictNew={};
	 var i;
	 for(i=0; i<dataSet.length; i++){
		 dictNew[dataSet[i]['label']]=0
	 }
	 for(i=0; i<dataSet.length; i++){
		 dictNew[dataSet[i]['label']] += Number(dataSet[i]['y'])
	 }
	 console.log("DictNew: ", dictNew)
	 var dataSetNew = [];
	 for(x in dictNew){
		 if(x=="March")
		 	dataSetNew.push({y:dictNew[x], label:x, indexLabel: "\u2605 LOCKDOWN 1.0"})
		else if(x=="April")
			dataSetNew.push({y:dictNew[x], label:x, indexLabel: "\u2605 LOCKDOWN 2.0"})
		else if(x=="May")
			dataSetNew.push({y:dictNew[x], label:x, indexLabel: "\u2605 LOCKDOWN 3.0"})
		else if(x=="June")
			dataSetNew.push({y:dictNew[x], label:x, indexLabel: "\u2605 UNLOCK 1.0"})
		else 
			dataSetNew.push({y:dictNew[x], label:x})

	 }

	sortByMonth(dataSetNew)
	callback(dataSetNew); 
   });
   } 
     
  function disp(dataSetNew){ 
   console.log('This must be printed after addition', dataSetNew);
   printChart(dataSetNew)
   }   

   function sortByMonth(arr) {
  var months = ["January", "February", "March", "April", "May", "June",
  	        "July", "August", "September", "October", "November", "December"];
  arr.sort(function(a, b){
      return months.indexOf(a.label)
           - months.indexOf(b.label);
  });
} 

   function printChart(dataSet){
	   console.log("Data set in printchart", dataSet)
	   var chart = new CanvasJS.Chart("chartContainer1", {
	animationEnabled: true,
	theme: "light2", // "light1", "light2", "dark1", "dark2"
	title:{
		text: "Monthly Downloads"
	},
	axisY: {
		title: "Mobile App Downloads"
	},
	axisX: {
		title: "Month"
	},
	data: [{        
		type: "column",  
		showInLegend: true, 
		legendMarkerColor: "grey",
		dataPoints: dataSet
		}]
	});
	chart.render();	

	var pieChart = new CanvasJS.Chart("chartContainer2", {
	animationEnabled: true,
	title: {
		text: "Area-Wise Mobile App Downloads"
	},
	data: [{
		type: "pie",
		startAngle: 240,
		yValueFormatString: "##0.00\"%\"",
		indexLabel: "{label} {y}",
		dataPoints: [
			{y: 79.45, label: "Bangalore"},
			{y: 7.31, label: "Pune"},
			{y: 7.06, label: "Mumbai"},
			{y: 4.91, label: "Delhi"},
			{y: 1.26, label: "Others"}
		]
	}]
});
pieChart.render();

}




window.onload = function () {
	add(5,6,disp);    

}
</script>
</head>
<body>
	<!-- header -->
	<nav class="navbar navbar-fixed-top" id="header">
		<div class="container-fluid">
			<div class="navbar-header">
			<img src="fretbox.png" alt="FretBox logo" width="100" height="66">
				<div id="sidebar-toggle-button">
					
				</div>
				<div class="brand">
					<a href="web-analytics-overview.html">
						<span class="hidden-xs-down m-r-3">Summary(2020) </span><span class="lead"></span>
					</a>
				</div>

			</div>
		</div>
	</nav>
	<!-- /header -->

	<!-- sidebar -->
	<div class="sidebar-toggle" id="sidebar">
		<ul class="nav nav-sidebar">
			<li>
				<a href="web-analytics-real-time.html">
					<i class="fa fa-clock-o fa-lg fa-fw" aria-hidden="true"></i>
					<span>Real Time</span>
				</a>
			</li>
			<li role="separator" class="divider"></li>
			<li>
				<a href="web-analytics-overview.html" class="active">
					<i class="fa fa-newspaper-o fa-lg fa-fw" aria-hidden="true"></i>
				</a>
			</li>
			<li role="separator" class="divider"></li>
		</ul>
	</div>
	<!-- /sidebar -->

	<div id="chartContainer1" style="height: 370px;"></div>
	<div id="chartContainer2" style="height: 370px;"></div>


</body>
</html>